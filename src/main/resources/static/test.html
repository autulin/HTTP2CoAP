<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>请求测试页面</title>
</head>
<body>
CoAP Server：<input type="text" id="cs" value="coap://127.0.0.1:5683" name="coapserver">
<div>
    Resource Name:<input type="text" id="getsource" value="helloWorld">
    <input type="button" id="get_btn" value="GET">
</div>
<div>
    Resource Name:<input type="text" id="postsource" value="helloWorld">
    Data:<input type="text" id="postbody" value="test">
    <input type="button" id="post_btn" value="POST">
</div>
<div>
    Resource Name:<input type="text" id="putsource" value="helloWorld">
    Data:<input type="text" id="putbody" value="test">
    <input type="button" id="put_btn" value="PUT">
</div>
<div>
    Resource Name:<input type="text" id="deletesource" value="helloWorld">
    <input type="button" id="delete_btn" value="DELETE">
</div>

<script src="/js/jquery-3.3.1.min.js"></script>
<script>

    $(function () {
        // GET
        $('#get_btn').on('click', function () {
            console.log("get click")
            csrf = $('input[name="csrfmiddlewaretoken"]').val();
            coapServer = $('#cs').val()
            resource = $('#getsource').val()
            $.get('/proxy/'+ coapServer + '/' + resource, function (obj) {
                console.log(obj)
                alert(obj)
            });
        });
        // POST
        $('#post_btn').on('click', function () {
            console.log("post click")
            csrf = $('input[name="csrfmiddlewaretoken"]').val();
            coapServer = $('#cs').val()
            resource = $('#postsource').val()
            body = $('#postbody').val()
            $.ajax({
                url: '/proxy/'+ coapServer + '/' + resource,
                type:'POST',
                data: body,
                contentType: "application/text;charset=utf-8",
                // contentType:'text/plain;charset=utf-8',
                dataType: 'text',
                // headers:{'X-CSRFToken':csrf},
                // beforeSend:function (jqXHR, options) {
                //     jqXHR.setRequestHeader("Content-Type", "text/plain;charset=utf-8")
                // },
                success: function (res) {
                    console.log('响应成功', res)
                    alert(res)
                },
                error: function () {
                    console.log('请求失败')
                    alert("error!")
                }
            })
        })
        // PUT
        $('#put_btn').on('click', function () {
            console.log("put click")
            csrf = $('input[name="csrfmiddlewaretoken"]').val();
            coapServer = $('#cs').val()
            resource = $('#putsource').val()
            body = $('#putbody').val()
            $.ajax({
                url: '/proxy/'+ coapServer + '/' + resource,
                type:'PUT',
                data: body,
                dataType: 'text',
                headers:{'X-CSRFToken':csrf},
                success: function (res) {
                    console.log('响应成功', res)
                    alert(res)
                },
                error: function () {
                    console.log('请求失败')
                    alert("error!")
                }
            })
        })
        // DELETE
        $('#delete_btn').on('click', function () {
            console.log("delete click")
            csrf = $('input[name="csrfmiddlewaretoken"]').val();
            coapServer = $('#cs').val()
            resource = $('#deletesource').val()
            $.ajax({
                url: '/proxy/'+ coapServer + '/' + resource,
                type:'DELETE',
                dataType: 'text',
                headers:{'X-CSRFToken':csrf},
                success: function (res) {
                    console.log('响应成功', res)
                    alert(res)
                },
                error: function () {
                    console.log('请求失败')
                    alert("error!")
                }
            })
        })

        // 显示所有信息
        /*$('#showStus').on('click', function () {
            $.get('/stu/student/', function (obj) {
                var msg = obj.data
                s = '<table><tr><td>ID</td><td>姓名</td><td>电话</td><td>操作</td></tr>'
                for (var i=0; i<msg.length; i+=1){
                    s += '<tr><td> ' + msg[i].id + '</td>\
                         <td>' + msg[i].s_name + '</td>\
                         <td>' + msg[i].s_tel + '</td>\
                         <td><a href="javascript:;" onclick="update_stu(' + msg[i].id + ')">编辑|</a>\
                         <a href="javascript:;" onclick="del_stu(' + msg[i].id + ')">删除</a>\
                         </td></tr>'
                }
                s += '</table>';
                $('.div_stus').html(s);
            }, 'json');
        });*/
    });
</script>
</body>
</html>